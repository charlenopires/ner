{% extends "base.html" %}
{% block content %}
<main class="main" style="grid-template-columns: 1fr;">

    <!-- HERO -->
    <div class="hero">
        <h1
            style="background: linear-gradient(135deg, #e8e8f0 0%, #3b82f6 40%, #9333ea 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
            Simulador GLiNER â€” SOTA 2024/2025
        </h1>
        <p>
            Modelos tradicionais de NER precisam de treino rÃ­gido com rÃ³tulos fixos. Os modelos <strong>SOTA
                (State-of-the-Art)</strong>
            como o <strong>GLiNER</strong> sÃ£o <em>Zero-Shot Generalists</em> â€” recebem as categorias via "prompt" e
            usam <strong>Dot Product</strong> de similaridade entre Spans de texto e vetores semÃ¢nticos das classes.
        </p>
    </div>

    <!-- Architecture diagram -->
    <div class="card" style="margin-bottom: 1rem;">
        <div class="card-header">
            <span class="card-title">ğŸ§¬ Arquitetura Span-Based NER</span>
            <span class="badge badge-crf"
                style="background: rgba(147, 51, 234, 0.15); color: #a78bfa; border-color: rgba(147, 51, 234, 0.3);">Zero-Shot</span>
        </div>
        <div class="algo-diagram">
            <div class="algo-step done"><span class="algo-emoji">ğŸ“„</span>Texto</div>
            <span class="algo-arrow">â†’</span>
            <div class="algo-step done"><span class="algo-emoji">âœ‚ï¸</span>TokenizaÃ§Ã£o</div>
            <span class="algo-arrow">â†’</span>
            <div class="algo-step active"
                style="border-color: #9333ea; color: #a78bfa; background: rgba(147, 51, 234, 0.08); box-shadow: 0 0 12px rgba(147, 51, 234, 0.2);">
                <span class="algo-emoji">ğŸ“</span>Span Enum
            </div>
            <span class="algo-arrow">â†’</span>
            <div class="algo-step active"
                style="border-color: #3b82f6; color: #60a5fa; background: rgba(59, 130, 246, 0.08); box-shadow: 0 0 12px rgba(59, 130, 246, 0.2);">
                <span class="algo-emoji">ğŸ§®</span>Dot Product
            </div>
            <span class="algo-arrow">â†’</span>
            <div class="algo-step"><span class="algo-emoji">ğŸ¯</span>Threshold</div>
            <span class="algo-arrow">â†’</span>
            <div class="algo-step"><span class="algo-emoji">âœ…</span>PrediÃ§Ãµes</div>
        </div>
    </div>

    <!-- Concept cards -->
    <div class="card" style="margin-bottom: 1rem;">
        <div class="card-header">
            <span class="card-title">ğŸ’¡ Tradicional vs. SOTA</span>
        </div>
        <div class="card-body">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div
                    style="padding: 1rem; background: var(--bg-card-3); border-radius: var(--radius-sm); border: 1px solid rgba(245, 158, 11, 0.2);">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <span style="font-size: 1.2rem;">ğŸ›ï¸</span>
                        <strong style="color: var(--loc-color); font-size: 0.9rem;">Tradicional (CRF/HMM)</strong>
                    </div>
                    <ul
                        style="font-size: 0.82rem; color: var(--text-secondary); padding-left: 1.2rem; line-height: 1.8;">
                        <li>Tags fixas: PER, LOC, ORG, MISC</li>
                        <li>Requer re-treinar para novas classes</li>
                        <li>ClassificaÃ§Ã£o Token â†¦ Tag (BIO)</li>
                        <li>Sequencial (cada token influencia o prÃ³ximo)</li>
                    </ul>
                </div>
                <div
                    style="padding: 1rem; background: var(--bg-card-3); border-radius: var(--radius-sm); border: 1px solid rgba(147, 51, 234, 0.2);">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <span style="font-size: 1.2rem;">ğŸš€</span>
                        <strong style="color: #a78bfa; font-size: 0.9rem;">SOTA (GLiNER / Span-Based)</strong>
                    </div>
                    <ul
                        style="font-size: 0.82rem; color: var(--text-secondary); padding-left: 1.2rem; line-height: 1.8;">
                        <li>Classes dinÃ¢micas via prompt</li>
                        <li>Zero-Shot â€” sem re-treinamento</li>
                        <li>ClassificaÃ§Ã£o Span â†¦ Classe (Dot Product)</li>
                        <li>Paralelo (spans independentes)</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Input card -->
    <div class="card">
        <div class="card-header">
            <span class="card-title">ğŸ“ Texto + Classes Zero-Shot</span>
        </div>
        <div class="card-body">
            <form hx-post="/htmx/sota" hx-target="#sota-results" hx-indicator="#sota-indicator"
                style="display: flex; flex-direction: column; gap: 1rem;">

                <!-- Zero-Shot Class input -->
                <div class="algo-mode-panel" style="flex-direction: column; align-items: stretch;">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span class="algo-mode-label">ğŸ¯ Classes Zero-Shot:</span>
                        <span style="font-size: 0.72rem; color: var(--text-muted);">(separadas por vÃ­rgula)</span>
                    </div>
                    <input type="text" name="classes" id="sota-classes" value="Pessoa, Local, Organizacao, Data"
                        placeholder="ex: Pessoa, Local, Gato, Pokemon..."
                        style="width: 100%; border: 1px solid var(--border-bright); background: var(--bg-card-3); color: var(--text-primary); padding: 0.75rem 1rem; border-radius: var(--radius-sm); font-family: 'Inter', sans-serif; font-size: 0.95rem; margin-top: 0.5rem; outline: none; transition: border-color 0.2s;">
                    <div style="display: flex; flex-wrap: wrap; gap: 0.4rem; margin-top: 0.5rem;">
                        <button type="button" class="demo-btn"
                            onclick="setSotaClasses('Pessoa, Local, Organizacao')">ğŸ·ï¸ ClÃ¡ssico</button>
                        <button type="button" class="demo-btn" onclick="setSotaClasses('Pessoa, Data')">ğŸ“… Pessoa +
                            Data</button>
                        <button type="button" class="demo-btn" onclick="setSotaClasses('Organizacao, Local')">ğŸ¢ Org +
                            Local</button>
                        <button type="button" class="demo-btn"
                            onclick="setSotaClasses('Pessoa, Local, Organizacao, Data')">ğŸŒ Completo</button>
                    </div>
                </div>

                <div class="input-area">
                    <textarea id="sota-text-input" name="text" rows="5"
                        placeholder="Texto livre...">Em marÃ§o de 2024, Luiz InÃ¡cio Lula da Silva representou o Brasil em uma reuniÃ£o no STF contra os grandes bancos, incluindo analistas da Apple Inc.</textarea>
                </div>

                <!-- Demo texts -->
                <div class="demo-texts">
                    <span style="font-size:0.75rem; color:var(--text-muted); align-self:center;">Exemplos:</span>
                    <button type="button" class="demo-btn"
                        onclick="setSotaDemo('Santos Dumont voou sobre Paris em outubro de 1901. O 14-Bis decolou do Campo de Bagatelle.')">HistÃ³rico</button>
                    <button type="button" class="demo-btn"
                        onclick="setSotaDemo('A Petrobras e o BNDES investiram R$2 bilhÃµes em SÃ£o Paulo durante janeiro de 2025.')">EconÃ´mico</button>
                    <button type="button" class="demo-btn"
                        onclick="setSotaDemo('Neymar Jr. assinou contrato com o Al-Hilal na ArÃ¡bia Saudita em agosto de 2023.')">Esportivo</button>
                </div>

                <button type="submit" class="btn-analyze"
                    style="background: linear-gradient(135deg, #3b82f6, #9333ea);">
                    <span>ğŸš€</span>
                    <span>Executar SOTA MÃ¡gico</span>
                </button>
            </form>

            <!-- Result display -->
            <div style="margin-top: 1.5rem; position: relative;">
                <div class="card-title" style="margin-bottom:0.75rem;">
                    ğŸ§® AnÃ¡lise Vetorial Bidirecional (Span-to-Class)
                </div>

                <div id="sota-indicator" class="htmx-indicator" style="position: absolute; top: 0; right: 0;">
                    <div class="spinner" style="border-top-color: #9333ea;"></div>
                </div>

                <div id="sota-results"
                    style="background: var(--bg-card-3); border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 1.25rem; min-height: 100px;">
                    <p class="placeholder-text">Clique em "Executar" para assistir a mÃ¡gica Span-Based acontecendo.</p>
                </div>
            </div>
        </div>

        <!-- Legend -->
        <div class="legend">
            <div class="legend-item">
                <div class="legend-dot" style="background: linear-gradient(135deg, #3b82f6, #9333ea);"></div>
                <span>ğŸ§® Dot Product Score</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot" style="background:var(--accent-green)"></div>
                <span>âœ… Acima do Threshold</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot" style="background:var(--text-muted)"></div>
                <span>âŒ Abaixo do Threshold</span>
            </div>
        </div>
    </div>

</main>

<style>
    .htmx-indicator {
        display: none;
    }

    .htmx-request .htmx-indicator,
    .htmx-request.htmx-indicator {
        display: block;
    }

    #sota-classes:focus {
        border-color: #9333ea;
        box-shadow: 0 0 0 3px rgba(147, 51, 234, 0.1);
    }
</style>

<script>
    function setSotaClasses(classes) {
        document.getElementById('sota-classes').value = classes;
    }
    function setSotaDemo(text) {
        document.getElementById('sota-text-input').value = text;
    }
</script>
{% endblock %}