{% extends "base.html" %}
{% block content %}
<main class="main" style="grid-template-columns: 1fr;">

    <!-- HERO -->
    <div class="hero">
        <h1>Tokeniza√ß√£o Educacional</h1>
        <p>
            Explore como o mesmo texto √© dividido de formas diferentes por cada estrat√©gia de tokeniza√ß√£o.
            A escolha do tokenizador afeta diretamente os vetores de features e, consequentemente, o que o modelo
            consegue aprender.
        </p>
    </div>

    <!-- Pipeline diagram -->
    <div class="card" style="margin-bottom: 1rem;">
        <div class="card-header">
            <span class="card-title">üìä Pipeline de Tokeniza√ß√£o</span>
        </div>
        <div class="algo-diagram">
            <div class="algo-step done"><span class="algo-emoji">üìÑ</span>Texto Bruto</div>
            <span class="algo-arrow">‚Üí</span>
            <div class="algo-step active"><span class="algo-emoji">‚úÇÔ∏è</span>Tokenizador</div>
            <span class="algo-arrow">‚Üí</span>
            <div class="algo-step"><span class="algo-emoji">üî§</span>Tokens</div>
            <span class="algo-arrow">‚Üí</span>
            <div class="algo-step"><span class="algo-emoji">üìê</span>Offsets</div>
            <span class="algo-arrow">‚Üí</span>
            <div class="algo-step"><span class="algo-emoji">üî¨</span>Features</div>
        </div>
    </div>

    <!-- HOW IT WORKS ‚Äî Concept cards -->
    <div class="card" style="margin-bottom: 1rem;">
        <div class="card-header">
            <span class="card-title">üéì Como o Tokenizador Trabalha o Texto</span>
            <span class="badge badge-ws" style="font-size: 0.65rem;">Passo a Passo</span>
        </div>
        <div class="card-body">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem;">
                <div
                    style="padding: 1rem; background: var(--bg-card-3); border-radius: var(--radius-sm); border-left: 4px solid var(--accent-cyan);">
                    <h4 style="color: var(--accent-cyan); font-size: 0.85rem; margin-bottom: 0.4rem;">‚ë† Leitura
                        Sequencial</h4>
                    <p style="font-size: 0.78rem; color: var(--text-secondary); line-height: 1.6; margin: 0;">
                        O tokenizador percorre o texto caractere por caractere. Ao encontrar um espa√ßo ou pontua√ß√£o,
                        marca a fronteira e emite um token com seus <strong>offsets</strong> (posi√ß√£o de in√≠cio e fim).
                    </p>
                </div>
                <div
                    style="padding: 1rem; background: var(--bg-card-3); border-radius: var(--radius-sm); border-left: 4px solid #a78bfa;">
                    <h4 style="color: #a78bfa; font-size: 0.85rem; margin-bottom: 0.4rem;">‚ë° Regras de Exce√ß√£o</h4>
                    <p style="font-size: 0.78rem; color: var(--text-secondary); line-height: 1.6; margin: 0;">
                        Abrevia√ß√µes ("Dr.", "N.Y."), URLs ("www.site.com"), emails e n√∫meros decimais ("2,5%")
                        possuem <strong>regras especiais</strong> que impedem a separa√ß√£o indevida.
                    </p>
                </div>
                <div
                    style="padding: 1rem; background: var(--bg-card-3); border-radius: var(--radius-sm); border-left: 4px solid var(--accent-green);">
                    <h4 style="color: var(--accent-green); font-size: 0.85rem; margin-bottom: 0.4rem;">‚ë¢ Subword (BPE)
                    </h4>
                    <p style="font-size: 0.78rem; color: var(--text-secondary); line-height: 1.6; margin: 0;">
                        No modo BPE Lite, palavras longas s√£o divididas em <strong>sub-unidades</strong> frequentes.
                        "desambigua√ß√£o" ‚Üí "des" + "##ambigu" + "##a√ß√£o". √ötil para vocabul√°rios pequenos.
                    </p>
                </div>
                <div
                    style="padding: 1rem; background: var(--bg-card-3); border-radius: var(--radius-sm); border-left: 4px solid var(--loc-color);">
                    <h4 style="color: var(--loc-color); font-size: 0.85rem; margin-bottom: 0.4rem;">‚ë£ Impacto no NER
                    </h4>
                    <p style="font-size: 0.78rem; color: var(--text-secondary); line-height: 1.6; margin: 0;">
                        Mais tokens = mais features de contexto. Menos tokens = mais informa√ß√£o por token.
                        O <strong>equil√≠brio</strong> √© crucial: separar demais separa "Nova York" em peda√ßos sem
                        sentido.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Input card -->
    <div class="card">
        <div class="card-header">
            <span class="card-title">üìù Texto de Entrada</span>
        </div>
        <div class="card-body">
            <form hx-post="/htmx/tokenize" hx-target="#token-results" hx-indicator="#token-indicator"
                style="display: flex; flex-direction: column; gap: 1rem;">

                <!-- Tokenizer Mode Selector -->
                <div class="algo-mode-panel">
                    <span class="algo-mode-label">üî† Estrat√©gia:</span>
                    <div class="algo-mode-toggle" id="tok-mode-toggle">
                        <button type="button" class="mode-btn active" data-mode="standard"
                            onclick="selectTokMode(this, 'standard')">
                            Standard
                        </button>
                        <button type="button" class="mode-btn" data-mode="aggressive"
                            onclick="selectTokMode(this, 'aggressive')">
                            Aggressive
                        </button>
                        <button type="button" class="mode-btn" data-mode="conservative"
                            onclick="selectTokMode(this, 'conservative')">
                            Conservative
                        </button>
                        <button type="button" class="mode-btn" data-mode="bpe_lite"
                            onclick="selectTokMode(this, 'bpe_lite')">
                            BPE Lite
                        </button>
                        <button type="button" class="mode-btn" data-mode="char_level"
                            onclick="selectTokMode(this, 'char_level')">
                            Char
                        </button>
                    </div>
                    <span class="mode-desc" id="tok-mode-desc">Palavras/Pontua√ß√£o com tratamento de abrevia√ß√µes</span>
                </div>
                <input type="hidden" name="tokenizer_mode" id="tokenizer_mode_input" value="standard">

                <div class="input-area">
                    <textarea id="tok-text-input" name="text" rows="5"
                        placeholder="Digite algo complexo com abrevia√ß√µes, n√∫meros, locu√ß√µes ou cl√≠ticos...">A Sra. Silva (nascida em 15/03/1980) comprou U$5.000,00 na bolsa de N.Y. √†s 14h30min usando seu e-mail ana.silva@exemplo.com.br! O site www.financas.com reportou que as a√ß√µes da Apple subiram 2,5%.</textarea>
                </div>

                <!-- Demo texts -->
                <div class="demo-texts">
                    <span style="font-size:0.75rem; color:var(--text-muted); align-self:center;">Exemplos:</span>
                    <button type="button" class="demo-btn"
                        onclick="setTokDemo('O Dr. Jo√£o F. da Silva Jr. viajou para S√£o Paulo √†s 14h30.')">Abrevia√ß√µes</button>
                    <button type="button" class="demo-btn"
                        onclick="setTokDemo('D√™-me isso! Lev√°-lo-ei ao ponto de √¥nibus.')">Cl√≠ticos</button>
                    <button type="button" class="demo-btn"
                        onclick="setTokDemo('O Supremo Tribunal Federal votou 8x3 contra a P.E.C. 45/2019.')">Siglas</button>
                    <button type="button" class="demo-btn"
                        onclick="setTokDemo('user@email.com visitou http://www.site.com.br/pagina?id=42&lang=pt-BR')">URLs/Emails</button>
                    <button type="button" class="demo-btn"
                        onclick="setTokDemo('A Petrobras lucrou R$188,3bi em 2023. A NYSE abriu 0,45% em alta.')">N√∫meros</button>
                </div>

                <button type="submit" class="btn-analyze">
                    <span>‚úÇÔ∏è</span>
                    <span>Extrair Tokens</span>
                </button>
            </form>

            <!-- Result display -->
            <div style="margin-top: 1.5rem; position: relative;">
                <div class="card-title" style="margin-bottom:0.75rem;">
                    üî§ Resultado da Tokeniza√ß√£o
                </div>

                <!-- Loading indicator -->
                <div id="token-indicator" class="htmx-indicator" style="position: absolute; top: 0; right: 0;">
                    <div class="spinner"></div>
                </div>

                <div id="token-results"
                    style="background: var(--bg-card-3); border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 1.25rem; min-height: 100px;">
                    <p class="placeholder-text">Clique em "Extrair Tokens" para visualizar o resultado.</p>
                </div>
            </div>
        </div>

        <!-- Legend -->
        <div class="legend">
            <div class="legend-item">
                <div class="legend-dot" style="background:var(--accent-cyan)"></div>
                <span>‚úÇÔ∏è Standard</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot" style="background:var(--accent-purple)"></div>
                <span>‚ö° Aggressive</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot" style="background:var(--accent-green)"></div>
                <span>üõ°Ô∏è Conservative</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot" style="background:var(--accent-blue)"></div>
                <span>üß© BPE Lite</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot" style="background:var(--loc-color)"></div>
                <span>üî° Char Level</span>
            </div>
        </div>
    </div>

</main>

<style>
    .htmx-indicator {
        display: none;
    }

    .htmx-request .htmx-indicator,
    .htmx-request.htmx-indicator {
        display: block;
    }
</style>

<script>
    const TOK_DESCRIPTIONS = {
        standard: 'Palavras/Pontua√ß√£o com tratamento de abrevia√ß√µes',
        aggressive: 'Separa√ß√£o agressiva de cl√≠ticos e sufixos',
        conservative: 'Preserva locu√ß√µes e nomes compostos',
        bpe_lite: 'Simula√ß√£o de sub-word tokenization (BPE)',
        char_level: 'Tokeniza√ß√£o caractere a caractere',
    };

    function selectTokMode(btn, mode) {
        document.querySelectorAll('#tok-mode-toggle .mode-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('tokenizer_mode_input').value = mode;
        const desc = document.getElementById('tok-mode-desc');
        if (desc) desc.textContent = TOK_DESCRIPTIONS[mode] || '';
    }

    function setTokDemo(text) {
        document.getElementById('tok-text-input').value = text;
    }
</script>
{% endblock %}